<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>LawrencePeng&#39;s Blog | 专注收集代码小精灵</title>

  
  <meta name="author" content="LawrencePeng">
  

  
  <meta name="description" content="Meow">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="LawrencePeng&#39;s Blog"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="LawrencePeng&#39;s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">LawrencePeng&#39;s Blog</a>
    </h1>
    <p class="site-description">专注收集代码小精灵</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span></span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/12/29/FastDFS多机部署/" rel="bookmark">
        <time class="entry-date published" datetime="2017-12-29T07:45:04.722Z">
          2017-12-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="FastDFS多机部署"><a href="#FastDFS多机部署" class="headerlink" title="FastDFS多机部署"></a>FastDFS多机部署</h1><ol>
<li><p>配置tracker服务</p>
<ol>
<li><p>复制一份配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp /etc/fdfs/tracker.conf /etc/fdfs/tracker.conf.old</div><div class="line">cp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf</div></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>编辑</p>
<p><code>vim /etc/fdfs/tracker.conf</code></p>
<p>修改base_path(数据和日志存放处)</p>
</li>
<li><p>启动tracker服务</p>
<p><code>/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf</code></p>
</li>
<li><p>查看是否有 tracker 进程</p>
<p><code>ps aux | grep tracker</code></p>
</li>
</ol>
</li>
<li><p>storage结点部署</p>
<ol>
<li><p>复制一份配置文件：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp /etc/fdfs/storage.conf /etc/fdfs/storage.conf.old</div><div class="line">cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf</div></pre></td></tr></table></figure>
</li>
</ol>
<p>​</p>
<ol>
<li><p>编辑：<code>vim /etc/fdfs/storage.conf</code></p>
</li>
<li><p>修改base_path、group_name、port、store_path（如果有多个盘，应该配置多个目录）、tracker_server（对应4的tracker服务）</p>
</li>
<li><p>启动</p>
<p><code>/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart</code></p>
</li>
<li><p>查看是否有storage进程</p>
<p><code>ps aux | grep storage</code></p>
<p>Storage结点都可以以此方式部署在多个主机上。</p>
</li>
<li><p>修改/etc/fdfs/mod_fastdfs.conf</p>
<ol>
<li><p>修改group_count</p>
</li>
<li><p>在底部添加group信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">storage_server_port=23000</div><div class="line">group_name=group1 </div><div class="line">url_have_group_name=true</div><div class="line">group_count=2</div><div class="line">[group1]</div><div class="line">group_name=group1</div><div class="line">storage_server_port=23000</div><div class="line">store_path_count=1</div><div class="line">store_path0=/data/fastdfs/storage</div><div class="line">[group2]</div><div class="line">group_name=group2</div><div class="line">storage_server_port=23000</div><div class="line">store_path_count=1</div><div class="line">store_path0=/data/fastdfs/storage1</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ol>
</li>
</ol>
</li>
<li><p>nginx配置</p>
<ol>
<li><p>tracker的nginx配置</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="section">http</span> &#123;</div><div class="line"> <span class="attribute">upstream</span> fdfs_group3 &#123; <span class="comment">#设置group3的服务器  </span></div><div class="line">   <span class="attribute">server</span> ip:port;</div><div class="line"> &#125;</div><div class="line">  </div><div class="line"> <span class="section">server</span> &#123;  </div><div class="line">   <span class="attribute">listen</span> <span class="number">80</span>;                <span class="comment">#设置服务器端口  </span></div><div class="line">   <span class="attribute">server_name</span> ip_of_tracker;  </div><div class="line">  </div><div class="line">   <span class="attribute">location</span> /group1/M00 &#123;</div><div class="line">     <span class="attribute">root</span> /data/fastdfs/storage/data;</div><div class="line">     ngx_fastdfs_module;</div><div class="line">     <span class="attribute">add_header</span> <span class="string">'Access-Control-Allow-Origin'</span> <span class="string">"*"</span>;</div><div class="line">   &#125;  </div><div class="line">  </div><div class="line">   <span class="attribute">location</span> /group2/M00 &#123;</div><div class="line">     <span class="attribute">root</span> /data/fastdfs/storage1/data;</div><div class="line">     ngx_fastdfs_module;</div><div class="line">     <span class="attribute">add_header</span> <span class="string">'Access-Control-Allow-Origin'</span> <span class="string">"*"</span>;</div><div class="line">   &#125;</div><div class="line">    </div><div class="line">   <span class="attribute">location</span> /group3/M00 &#123; <span class="comment">#如果是远程Storage结点，通过proxy_pass访问</span></div><div class="line">      <span class="attribute">proxy_pass</span> http://fdfs_group3;</div><div class="line">      </div><div class="line">    &#125;</div><div class="line"> &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>storage的配置</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">server</span>  </div><div class="line">&#123;  </div><div class="line"> <span class="attribute">listen</span> a_port;  </div><div class="line"> <span class="attribute">server_name</span> another_ip_of_storage;   </div><div class="line">  </div><div class="line"> <span class="attribute">location</span> /group3/M01/ &#123;  </div><div class="line"> 	<span class="attribute">root</span> /data/fastdfs/storage/data;</div><div class="line"> 	<span class="attribute">rewrite</span><span class="regexp"> ^/group2/M01/(.*)</span> /<span class="variable">$1</span> <span class="literal">break</span>;</div><div class="line">    <span class="attribute">add_header</span> <span class="string">'Access-Control-Allow-Origin'</span> <span class="string">"*"</span>;</div><div class="line"> &#125;</div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ol>
</li>
<li><p>其他事项</p>
<p><strong>访问文件服务器的文件时，地址要用tracker的地址。</strong></p>
</li>
</ol>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 LawrencePeng
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>